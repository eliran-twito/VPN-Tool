<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
      xmlns="http://www.w3.org/1999/html">
<head>
    <title>VPN Tool</title>
	<link rel="stylesheet" href="https://cdn.metroui.org.ua/v4/css/metro-all.min.css">
    <script src="js/jquery.min.js"></script>
    <script type="text/javascript" src="/eel.js"></script>
</head>
<body> <!--=oncontextmenu="return false" onselectstart="return false" ondragstart="return false">-->

 	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="https://cdn.metroui.org.ua/v4/js/metro.min.js"></script>
<aside class="sidebar pos-absolute z-2"
       data-role="sidebar"
       data-toggle="#sidebar-toggle-3"
       id="sb3"
       data-shift=".shifted-content">
    <div class="sidebar-header" data-image="images/sb-bg-1.jpg">
        <div class="avatar">
            <img src="images/checkpoint.png">
        </div>
        <span class="title fg-white">VPN TOOL</span>
        <span class="subtitle fg-white"> 2023 Â© Eliran Twito</span>
    </div>
    <ul class="sidebar-menu">
        <li id="homeScreen"><a><span class="mif-home icon"></span>Home</a></li>
        <li id="solutionScreen"><a><span class="mif-dashboard icon"></span>Solutions Repository</a></li>
        <li id="debuggingScreen"><a><span class="mif-bug icon"></span>Debugging</a></li>
        <li id="scriptScreen"><a><span class="mif-hammer icon"></span>Script</a></li>
        <li class="divider"></li>
        <li id="Exit"><a><span class="mif-exit icon"></span>Exit</a></li>
    </ul>
</aside>
<div class="shifted-content h-100 p-ab" id="SideBarFix">
    <div class="app-bar pos-absolute bg-red z-1" data-role="appbar">

        <button class="app-bar-item c-pointer" id="sidebar-toggle-3">
            <span class="mif-menu fg-white"></span>
        </button>

        <p class="h2 fg-light" style="margin-left: 38%;" >VPN TOOL</p>
    </div>
    <section id="sectionHome">
    <div id="scanDiv" class="h-200 p-8">
            <div class="row">
                <div class="cell-6 offset-1">
                    <p class="h4 fg-grayMouse">Welcome to VPN Tool! </p>
                     <p>This tool should provide the abilities to easier the processes of debugging,<br> configuration and help find
                     more accurate and valuable bugs,<br>Enjoy!</p>
                </div>
                <div class="cell-24">
                     <button class="button light shadowed" id="btn1" style="margin-left: 40%;margin-top: 5%;">Start</button>
                </div>
            </div>
    </div>
    </section>
</div>
<div class="container z-1">

		<section id="sectionSolution" style="display: none;margin-left: 10%;margin-top: 3%;">
			<h5 class="text-light text-bold">Solutions Repository</h5>
			<hr/>
            Search for an issue
                <select data-role="select" id="select1">
                        <optgroup label="Route Based">
                            <option id="bgp1" value="BGP">Route Based BGP - no bgp routes</option>
                            <option id="ospf1" value="OSPF">Route Based OSPF - no ospf routes</option>
                        </optgroup>
                        <optgroup label="FWAccel">
                                <option value="Acceleration">Acceleration issues</option>
                                <option value="Fwacceldebug">FWaccel debug</option>
                            </optgroup>
                        <optgroup label="General">
                                <option value="fwk.elg_error01">"inSPI / outSPI failed to get entry -1" messages</option>
                            </optgroup>

                    </select>
			<ul data-role="treeview" id="solutionView">
			</ul>

		</section>
        <section id="sectionDebugging" style="display: none;margin-left: 10%;margin-top: 3%;">
			<h5 class="text-light text-bold">Advanced Debugging</h5>
            <p>hover the buttons to get more info</p>
			<hr/>
            <form data-role="validator" action="javascript:">
                        <div class="form-group">
                            <label>Machine IP:</label>
                            <input id="machine_IP" type="text" data-validate="required" name="SSH_machine_IP" >
                            <span class="invalid_feedback">
                                    Insert the IP of the machine you want to debug
                            </span>
                        </div>
                                        <div class="form-group">
                            <label>Username:</label>
                            <input id="machine_username" type="text" data-validate="required" name="SSH_machine_username" >
                            <span class="invalid_feedback">
                                    Insert the username of the machine you want to debug
                            </span>
                        </div>
                                        <div class="form-group">
                            <label>Password:</label>
                            <input id="machine_pass" type="password" data-validate="required" name="SSH_machine_pass" >
                            <span class="invalid_feedback">
                                    Insert the password of the machine you want to debug
                            </span>
                        </div>
            </form>
            <div id="Debugging_menu" class="h-200 p-8">
                Logs time range:
                <div class="row">
                    <div class="cell-md-4" style="margin-top: 2.5%;">
                    From:<input id="From_date" type="text" data-role="calendarpicker">
                        <input id="From_time" data-role="timepicker" data-seconds="false">
                    </div>
                    <div class="cell-md-4" style="margin-top: 2.5%;">
                    To:<input id="To_date" type="text" data-role="calendarpicker">
                        <input id="To_time" data-role="timepicker" data-seconds="false">
                    </div>
                    <div class="cell-10" style="margin-top: 8.5%;">
                            <button id="General_debug" class="button large alert" data-role="hint" data-hint-text="Summarizing general Userspace,Kernel debug errors and previous failures found in the past, including VPN advanced debug" data-cls-hint="bg-cyan fg-white drop-shadow" data-hint-hide="0">General Debug</button>
                            <button id="VPN_advanced" class="button large place-right alert" data-role="hint" data-hint-text="Summarizing VPN Userspace,Kernel debug errors and previous failures found in the past" data-cls-hint="bg-cyan fg-white drop-shadow" data-hint-hide="0">Advanced VPN debug</button>
                        </div>
                </div>
            </div>
                <ul data-role="treeview" id="debugView">
                </ul>

		</section>
            <section id="sectionScript" style="display: none;margin-left: 10%;margin-top: 3%;">
			<h5 class="text-light text-bold">Script Generator</h5>
			<hr/>
                <select data-role="select">
                        <optgroup label="Route Based Scripts">
                            <option value="BGP">BGP</option>
                            <option value="OSPF">OSPF</option>
                        </optgroup>
                    </select>
			<ul data-role="treeview" id="scriptView">
			</ul>

		</section>


    </div>
        <div id="bgp1_in" style="display: none;margin-left: 10%;margin-top: 3%; z-index: -2;">
                <h3>Route Based BGP - no bgp routes </h3>
            <p>1.Review your configuration ,make sure you are using "empty groups", make sure you have the right external remote-as peer configured,</br> if you use routemaps check if you allow these routes,</br> distributing the right routes.</br>You coul'd use the script generator to review your configuration.</p>
                <p>2.Use "fwmonitor" to see if the connection passes through the VPN tunnel interface </p>
                <p>3.tcpdump port 179 to see bgp traffic</p>
                <p>4.For more information use sk101399</p>

            </div>
       <div id="ospf1_in" style="display: none;margin-left: 10%;margin-top: 3%; z-index: -2;">
                <h3>Route Based OSPF - no OSPF routes </h3>
            <p>1.Review your configuration,make sure you are using "empty groups", make sure you have the right external remote-as peer configured,</br> if you use routemaps check if you allow these routes,</br> distributing the right routes.</br>You coul'd use the script generator to review your configuration.</p>
                <p>2.Use "fwmonitor" to see if the connection passes through the VPN tunnel interface </p>
                <p>3.tcpdump port 89 to see OSPF traffic</p>
                <p>4.For more information use sk84520</p>

            </div>
        <div id="fwk_error_01_in" style="display: none;margin-left: 10%;margin-top: 3%; z-index: -2;">
                <h3>"inSPI / outSPI failed to get entry -1" messages</h3>
                <p>fw_ghtab_ioctl_get is an ioctl call that is trying to find an entry from the kernel tables outSPI_to_instance_g, inSPI_to_instance_g and is not finding the entry,</br> Kernel debug is needed in this case,</br> however if there are no actual issues this is most likely cosmetic.</p>

        </div>

       <div id="bgp1_script_in" style="display: none;margin-left: 10%;margin-top: 3%;">
                    <form data-role="validator" action="javascript:">
                        <div class="form-group">
                            <label>Self AS</label>
                            <input id="BGP_self_AS" type="text" data-validate="number" name="Self AS" >
                            <span class="invalid_feedback">
                                    Insert a number between 1-65535
                            </span>
                        </div>
                        <div class="form-group">
                            <label>Peer AS</label>
                            <input id="BGP_peer_AS" type="text" data-validate="number" name="Peer AS">
                             <span class="invalid_feedback">
                                    Insert a number between 1-65535
                            </span>
                        </div>
                        <div class="form-group">
                            <label>Self VTI IP</label>
                            <input id="BGP_self_VTI" type="text" data-validate="required" name="Self VTI IP">
                            <span class="invalid_feedback">
                                    Please enter a valid IP address
                            </span>
                        </div>
                        <div class="form-group">
                            <label>Peer VTI IP</label>
                            <input id="BGP_peer_VTI" type="text" data-validate="required" name="Peer VTI IP">
                            <span class="invalid_feedback">
                                    Please enter a valid IP address
                            </span>
                        </div>
                        <div class="form-group">
                            <label>Peer Name</label>
                            <input id="BGP_peer_name" type="text" data-validate="required" name="Peer Name">
                            <span class="invalid_feedback">
                                    Please enter the Peer name
                            </span>
                        </div>
                        <br />
                        <button id="bgp_submit" class="button success">Submit</button>
                    </form>
            </div>
       <div id="ospf1_script_in" style="display: none;margin-left: 10%;margin-top: 3%;">
                    <form data-role="validator" action="javascript:">
                        <div class="form-group">
                            <label>Self VTI IP</label>
                            <input id="OSPF_self_VTI" type="text" data-validate="required" name="Self VTI IP">
                            <span class="invalid_feedback">
                                    Please enter a valid IP address
                            </span>
                        </div>
                        <div class="form-group">
                            <label>Peer VTI IP</label>
                            <input id="OSPF_peer_VTI" type="text" data-validate="required" name="Peer VTI IP">
                            <span class="invalid_feedback">
                                    Please enter a valid IP address
                            </span>
                        </div>
                        <div class="form-group">
                            <label>Peer Name</label>
                            <input id="OSPF_peer_name" type="text" data-validate="required" name="Peer Name">
                            <span class="invalid_feedback">
                                    Please enter the Peer name
                            </span>
                        </div>
                        <br />
                        <button id="ospf_submit" class="button success">Submit</button>
                    </form>

            </div>
<div id="BGP_script_output_in" style="display: none;margin-left: 10%;margin-top: 3%;">
                <h3>BGP + Numbered VTI script:</h3>
            <p id="BGP_result"></p>

            </div>

<div id="OSPF_script_output_in" style="display: none;margin-left: 10%;margin-top: 3%;">
                <h3>OSPF + Numbered VTI script:</h3>
            <p id="OSPF_result"></p>

            </div>
<div id="General_debug_output_in" style="display: none;margin-left: 10%;margin-top: 3%;">
            <p id="General_debug_result"></p>
    <p><b>For more info Please check logs under /var/log/VPN_Tool/ </b></p>

            </div>
<div id="vpn_debug_output_in" style="display: none;margin-left: 10%;margin-top: 3%;">
            <p id="vpn_debug_result"></p>
    <p><b>For more info Please check logs under /var/log/VPN_Tool/ </b></p>

            </div>
    <script>

        $( document ).ready(function() {
            $("#btn1").click(function() {
                console.log( "clicked!");
                SideBarFix.style.left = '290px';
                sb3.classList.add('open');
            });

        function taskStart(){
            progress = Metro.activity.open({
                type: 'cycle',
                overlayColor: '#fff',
                overlayAlpha: 1,
                text: '<div class=\'mt-2 text-small\'>Please, wait...</div>',
            });
        }
        function taskEnd() {
            Metro.activity.close(progress);
        }

        $("#Exit").on("click",function () {
        close();
        });

        $("#homeScreen").on("click",function () {
            $("#sectionSolution").fadeOut('500');
            $("#sectionDebugging").fadeOut('500');
            $("#sectionScript").fadeOut('500');
            $("#sectionHome").delay(250).fadeIn('500');
            $('#bgp1_in').hide();
            $('#fwk_error_01_in').hide();
            $('#ospf1_in').hide();
            $('#ospf1_script_in').hide();
            $('#bgp1_script_in').hide();
            $('#BGP_script_output_in').hide();
            $('#OSPF_script_output_in').hide();
            $('#General_debug_output_in').hide();
            $('#vpn_debug_output_in').hide();
             });

        $("#solutionScreen").on("click",function () {
            $("#sectionHome").fadeOut('500');
            $("#sectionScript").fadeOut('500');
            $("#sectionDebugging").fadeOut('500');
            $('#ospf1_script_in').hide();
            $('#bgp1_script_in').hide();
            $('#BGP_script_output_in').hide();
            $('#OSPF_script_output_in').hide();
            $('#General_debug_output_in').hide();
            $('#vpn_debug_output_in').hide();
            $("#sectionSolution").delay(500).fadeIn('500');
                if ($(".select-input")[0].textContent == "BGP - no bgp routes") {
                     $('#bgp1_in').show();
                     }
                     else
                     {
                     $('#bgp1_in').hide();
                     }
                      $($("ul.option-list li:nth-child(2)")[0]).click (function () {
                         $('#bgp1_in').show();
                         $('#ospf1_in').hide();
                         $('#fwk_error_01_in').hide();
                       });
                       $($("ul.option-list li:nth-child(3)")[0]).click (function () {
                         $('#ospf1_in').show();
                         $('#bgp1_in').hide();
                         $('#fwk_error_01_in').hide();
                       });
                        $($("ul.option-list li:nth-child(8)")[0]).click (function () {
                         $('#fwk_error_01_in').show();
                         $('#ospf1_in').hide();
                         $('#bgp1_in').hide();
                         });
            });

        $("#debuggingScreen").on("click",function () {
            $("#sectionHome").fadeOut('500');
            $("#sectionScript").fadeOut('500');
            $("#sectionSolution").fadeOut('500');
            $("#sectionDebugging").delay(500).fadeIn('500');
            $('#bgp1_in').hide();
            $('#fwk_error_01_in').hide();
            $('#ospf1_in').hide();
            $('#ospf1_script_in').hide();
            $('#bgp1_script_in').hide();
            $('#BGP_script_output_in').hide();
            $('#OSPF_script_output_in').hide();


                $("#General_debug").one("click",function() {
                    console.log("SSH_General_debug");
                    taskStart();
                    eel.general_debug_ssh($("#machine_IP").val(),$("#machine_username").val(),$("#machine_pass").val(),$("#From_date").val(),$("#From_time").val(),$("#To_date").val(),$("#To_time").val())(function (data) {
                            $("#General_debug_result").html(data);
                            $('#sectionDebugging').hide();
                            $('#vpn_debug_output_in').hide();
                            $('#General_debug_output_in').show();
                            var SSH_End = "done";
                            if (SSH_End == "done") {
                                            taskEnd();
                                            }
                                });
                                $("#General_debug").off().click(function(){ });
                                $("#VPN_advanced").off().click(function(){ });

                           });

                $("#VPN_advanced").one("click",function() {
                    console.log("SSH_VPN_A_debug");
                    taskStart();
                    eel.vpn_debug_ssh($("#machine_IP").val(),$("#machine_username").val(),$("#machine_pass").val(),$("#From_date").val(),$("#From_time").val(),$("#To_date").val(),$("#To_time").val())(function (data) {
                            $("#vpn_debug_result").html(data);
                            $('#sectionDebugging').hide();
                            $('#General_debug_output_in').hide();
                            $('#vpn_debug_output_in').show();
                            var SSH_End = "done";
                            if (SSH_End == "done") {
                                            taskEnd();
                                            }
                                });
                                $("#VPN_advanced").off().click(function(){ });
                                $("#General_debug").off().click(function(){ });
                           });

            });

        $("#scriptScreen").on("click",function () {
            $("#sectionHome").fadeOut('500');
            $("#sectionSolution").fadeOut('500');
            $("#sectionDebugging").fadeOut('500');
            $("#sectionScript").delay(500).fadeIn('500');
            $('#bgp1_in').hide();
            $('#fwk_error_01_in').hide();
            $('#ospf1_in').hide();
            $('#General_debug_output_in').hide();
            $('#vpn_debug_output_in').hide();
            if ($(".select-input")[1].textContent == "BGP") {
                     $('#bgp1_script_in').show();
                     }
                     else
                     {
                     $('#bgp1_script_in').hide();
                     }
                      $($("ul.option-list li:nth-child(2)")[1]).click (function () {
                         $('#bgp1_script_in').show();
                         $('#ospf1_script_in').hide();
                       });
                       $($("ul.option-list li:nth-child(3)")[1]).click (function () {
                         $('#ospf1_script_in').show();
                         $('#bgp1_script_in').hide();
                       });
                       $("#bgp_submit").click(function() {
                        eel.bgp_get_script_to_html($("#BGP_self_AS").val(),$("#BGP_peer_AS").val(),$("#BGP_self_VTI").val(),$("#BGP_peer_VTI").val(),$("#BGP_peer_name").val())(function (data) {
                        $("#BGP_result").html(data);
                        $('#bgp1_script_in').hide();
                        $('#BGP_script_output_in').show();
                            });
                        });
                        $("#ospf_submit").click(function() {
                        eel.ospf_get_script_to_html($("#OSPF_self_VTI").val(),$("#OSPF_peer_VTI").val(),$("#OSPF_peer_name").val())(function (data) {
                        $("#OSPF_result").html(data);
                        $('#ospf1_script_in').hide();
                        $('#OSPF_script_output_in').show();
                            });
                        });
            });



        });



    </script>
</body>

</html>